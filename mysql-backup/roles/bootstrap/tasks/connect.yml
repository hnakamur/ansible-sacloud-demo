---
- name: Connect disks to server
  sacloud_disk:
    access_token: "{{ lookup('env', 'ACCESS_TOKEN') }}"
    access_token_secret: "{{ lookup('env', 'ACCESS_TOKEN_SECRET') }}"
    disk_resource_id: "{{ item.0.ansible_facts.sacloud_disk_resource_id }}"
    server_resource_id: "{{ item.1.ansible_facts.sacloud_server_resource_id }}"
    zone: "{{ zone }}"
    state: connected
  with_together:
    - "{{ sacloud_disk.results }}"
    - "{{ sacloud_server.results }}"

- name: Connect router to server
  sacloud_router:
    access_token: "{{ lookup('env', 'ACCESS_TOKEN') }}"
    access_token_secret: "{{ lookup('env', 'ACCESS_TOKEN_SECRET') }}"
    router_resource_id: "{{ sacloud_router_resource_id }}"
    server_resource_id: "{{ item.ansible_facts.sacloud_server_resource_id }}"
    zone: "{{ zone }}"
    state: connected
  with_items:
    - "{{ sacloud_server.results }}"
